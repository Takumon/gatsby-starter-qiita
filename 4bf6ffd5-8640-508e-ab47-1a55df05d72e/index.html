<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/gatsby-starter-qiita/0.a327d153219dce8f5630.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/gatsby-starter-qiita/static/montserrat-latin-100-50d279861fb3cbfed809eae6ed8b9ac9.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-100-5e334eff013f12fbb8ed72c2a253f119.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/gatsby-starter-qiita/static/montserrat-latin-100italic-8c0705336558194799a8729840d7ed9d.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-100italic-03e19243272affe738654a157625ec26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/gatsby-starter-qiita/static/montserrat-latin-200-4343d3d91a9446226e7a8bbb024111ad.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-200-f2022ecd65a0703ec3edcb7641709a75.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/gatsby-starter-qiita/static/montserrat-latin-200italic-116c4c4b14ef76b0555da09854512022.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-200italic-89614a6008fc5c60739012463d0ee7e6.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/gatsby-starter-qiita/static/montserrat-latin-300-d2ad295b60682a6537c358e06ea80c61.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-300-3a371ee0d175f5c2b15ce1d6b981dc4e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/gatsby-starter-qiita/static/montserrat-latin-300italic-f6b6bf2431003f8142e800f9df157989.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-300italic-16521668f5f238098329cdd7d27c391e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/gatsby-starter-qiita/static/montserrat-latin-400-240a84447b78da0920fcb07e378f2c5f.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-400-b20cc131034316b1c85d0498fb9ed5c5.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/gatsby-starter-qiita/static/montserrat-latin-400italic-86172bb829de6be08b92512096b6aca6.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-400italic-9405e78785a55cf0e4ea7669d4616ea9.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/gatsby-starter-qiita/static/montserrat-latin-500-fb8d6b71dbe8d9294be43082936f649e.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-500-50825d47af7ae47e055018eb689c6c99.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/gatsby-starter-qiita/static/montserrat-latin-500italic-c0a555a4f8e997385a3eebbd4da0b9ee.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-500italic-635de59c4be86285b1f70068c95b9816.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/gatsby-starter-qiita/static/montserrat-latin-600-d5615136a08cfee70deb4be1ee1651df.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-600-f300da4fb4fe00e23915f62b2c643681.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/gatsby-starter-qiita/static/montserrat-latin-600italic-10f29d139edacde92df63374c5672568.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-600italic-2bc37d86a4ba12ce526c4af904a9946e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/gatsby-starter-qiita/static/montserrat-latin-700-7d77e1f03eefc452dab14d7f89080083.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-700-81826529772e52f0f14a4c73c2f2c7f1.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/gatsby-starter-qiita/static/montserrat-latin-700italic-1dd2b53f1567a29e0505de9b27c4352c.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-700italic-c162d257f5e9f9b108a96a604cfb2132.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/gatsby-starter-qiita/static/montserrat-latin-800-d4e7bf86bbd8e5f43ca73fa831218648.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-800-895aadbff357be35ac8dd107c7975ee7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/gatsby-starter-qiita/static/montserrat-latin-800italic-fc0cbe442f7b3733c91e982e825c4daa.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-800italic-b3362875067300abedb7a8fb97903258.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/gatsby-starter-qiita/static/montserrat-latin-900-c8bdd772c0d1347720ff7e3fb72719f3.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-900-1b99ef78e627dd9bbd0ca4b5c0789547.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/gatsby-starter-qiita/static/montserrat-latin-900italic-cb72c1f90f66c124fb897a75bec64c78.woff2) format("woff2"),url(/gatsby-starter-qiita/static/montserrat-latin-900italic-b78bb9f8ecec6c5a924c873f1818095f.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/gatsby-starter-qiita/static/merriweather-latin-300-f015f1e9a46a3b9db4fd64564dacece4.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-300-92dfe81b725c342d31d962da975c07a6.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/gatsby-starter-qiita/static/merriweather-latin-300italic-7fd86b32accf2df4403d1d4fa3a81502.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-300italic-878b76f59d5ba58dd1652dc8d2a0f4f9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/gatsby-starter-qiita/static/merriweather-latin-400-12dbf4c00ae43698f278b099e4b0ec9e.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-400-1fffad22b085a877995812dbf1d9ac08.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/gatsby-starter-qiita/static/merriweather-latin-400italic-1e0d3e8121d88969bfb153c8f174b758.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-400italic-de18d4c4e8e808a7248a185f866ff094.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/gatsby-starter-qiita/static/merriweather-latin-700-dc8fec81a125fc63856587e6683da73b.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-700-d7d2ed8e58f303392cc3fc00ba3a9186.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/gatsby-starter-qiita/static/merriweather-latin-700italic-b7b7e5da4d7be8c12bd5a6c809edc8fc.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-700italic-6210a5fc1c54ca85a5d82aa85d7a9b5c.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/gatsby-starter-qiita/static/merriweather-latin-900-43f870d543dd89fbeb66d417c0d97276.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-900-8f3806df74937c7b8b53f24ae1e725d1.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/gatsby-starter-qiita/static/merriweather-latin-900italic-168c1ab28ed0e4e7d654334def288bc1.woff2) format("woff2"),url(/gatsby-starter-qiita/static/merriweather-latin-900italic-ae7778f01871e35ee142ef207b313b34.woff) format("woff")}</style><style data-href="/gatsby-starter-qiita/component---src-templates-qiita-post-js.5b3dc63a45b213e05e7a.css">.code-lang{color:#eee;display:inline-block;background-color:#777;padding:2px 4px;-webkit-transform:translateY(-1em);transform:translateY(-1em);word-break:break-all}.code-frame,.highlight{background-color:#364549;color:#e3e3e3}.code-frame{margin:1.5em -32px;padding:1em 32px;font-size:.9em}.highlight .c,.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs,.highlight .gu{color:#9dabae}.highlight .k,.highlight .kc,.highlight .kd,.highlight .kp,.highlight .kr,.highlight .kt,.highlight .no{color:#ebd247}.highlight .fm,.highlight .gi,.highlight .na,.highlight .nc,.highlight .nd,.highlight .ne,.highlight .nf,.highlight .nx{color:#8bdf4c}.highlight .gd,.highlight .kn,.highlight .nt,.highlight .o,.highlight .ow{color:#ff8095}.highlight .dl,.highlight .ld,.highlight .s,.highlight .s1,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#41b7d7}.highlight .il,.highlight .l,.highlight .m,.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .se{color:#a980f5}.highlight .bp,.highlight .n,.highlight .nb,.highlight .ni,.highlight .nl,.highlight .nn,.highlight .nv,.highlight .p,.highlight .py,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm,.highlight .w{color:#e3e3e3}.highlight .hll{background-color:#49483e}.highlight .err{border-bottom:2px dotted #c01b1b;color:#ddd}.highlight .ge{font-style:italic}.highlight .gs{font-style:bold}.highlight{padding:.5em;overflow-x:auto}</style><meta name="generator" content="Gatsby 2.0.19"/><link rel="alternate" type="application/rss+xml" href="/gatsby-starter-qiita/rss.xml"/><link rel="shortcut icon" href="/gatsby-starter-qiita/icons/icon-48x48.png"/><link rel="manifest" href="/gatsby-starter-qiita/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><title data-react-helmet="true">undefined | Gatsby Starter Qiita</title><link data-react-helmet="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css"/><meta data-react-helmet="true" name="description" content="GradleのJavaアプリをJenkinsで１人CIするためのJenkinsfileを書いてみた。Githubにプッシュ時に、AWS上のJenkinsのパイプラインジョブが動いて、テストが成功したら同じくAWS上のTomcatにデプロイす..."/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><link as="script" rel="preload" href="/gatsby-starter-qiita/component---src-templates-qiita-post-js-2ffd488fa72a847d9af2.js"/><link as="script" rel="preload" href="/gatsby-starter-qiita/0-187f6b47a30213241321.js"/><link as="script" rel="preload" href="/gatsby-starter-qiita/app-1b1aadb11d2b90792575.js"/><link as="script" rel="preload" href="/gatsby-starter-qiita/webpack-runtime-2dc60d7c33a667247058.js"/><link rel="preload" href="/gatsby-starter-qiita/static/d/326/path---4-bf-6-ffd-5-8640-508-e-ab-47-1-a-55-df-05-d-72-e-20-d-e6b-xJbqEgGNSIsx1sPNn7ZW7tNNs.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:-1.75rem"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/gatsby-starter-qiita/">Gatsby Starter Qiita</a></h3><h1>Declarative PipelineでJenkinsfileを書いてみた(Checkstyle,Findbugs,PMD,CPDとか)</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">2017-04-07T02:38:55+09:00</p><div style="display:flex;margin-bottom:4.375rem"><img src="https://qiita-image-store.s3.amazonaws.com/0/49915/profile-images/1488080194" alt="Takumon" style="margin-right:0.875rem;margin-bottom:0;border-radius:1.75rem;width:3.5rem;height:3.5rem"/><div><div style="margin-top:0.175rem;font-size:1.05rem;line-height:1.05rem">Takumon</div><div style="font-size:0.875rem;margin-top:4px;line-height:0.875rem;opacity:0.5">SIer</div></div></div><div><p>GradleのJavaアプリをJenkinsで１人CIするためのJenkinsfileを書いてみた。<br>
Githubにプッシュ時に、AWS上のJenkinsのパイプラインジョブが動いて、テストが成功したら同じくAWS上のTomcatにデプロイするみたいな感じで使ってます。</p>

<h1>
<span id="declarative-pipeline" class="fragment"></span><a href="#declarative-pipeline"><i class="fa fa-link"></i></a>Declarative Pipeline</h1>

<p>いままではJenkinsfileを</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>node {
  ....
}
</pre></div></div>

<p>のように書いてましたが、<a href="https://jenkins.io/doc/book/pipeline/syntax/" rel="nofollow noopener" target="_blank">Jenkinsの公式サイト</a>を見ると<br>
これはScripted Pipelinesの記法であり、<br>
Pipeline Pluginのバージョン2.5移行からは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>pipeline {
  ....  
}
</pre></div></div>

<p>のように書くDeclarative Pipelineという記法が導入されて、<br>
そっちのほうがシンプルでわかりやすく書けるよ!ということだったので書き直してみました。<br>
確かにすっきりしたし（特に最後のメールおくるとことか、デプロイするとことか）、<br>
いざとなったら従来のScripted Pipelinesもミックスできるのでいい感じです。</p>

<h1>
<span id="追加したプラグイン" class="fragment"></span><a href="#%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%9F%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>追加したプラグイン</h1>

<p>Jenkins初期設定時のSuggested Pluginに入っていないもの</p>

<ul>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Checkstyle+Plugin;jsessionid=E9D4FA5064ACAE1CED7B19928DE0788F" rel="nofollow noopener" target="_blank">Checkstyle Plugin</a>（v3.47） - Checkstyeの結果収集用</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/FindBugs+Plugin" rel="nofollow noopener" target="_blank">FindBugs Plugin</a>（v4.69） - Findbugsのレポート生成用 </li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/PMD+Plugin" rel="nofollow noopener" target="_blank">PMD Plugin</a>（v3.46） - PMDのレポート生成用</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/DRY+Plugin" rel="nofollow noopener" target="_blank">DRY Plugin</a>（v2.46） - CPD(重複コードチェック)のレポート生成用</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Step+Counter+Plugin" rel="nofollow noopener" target="_blank">Step Counter Plugin</a>（v2.0.0） - ソースコードのステップ数を集計してくれる</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Task+Scanner+Plugin" rel="nofollow noopener" target="_blank">Task Scanner Plugin</a>（v4.50） - ソースコード中のTODOとかを一覧化してくれる</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Javadoc+Plugin" rel="nofollow noopener" target="_blank">Javadoc Plugin</a>（v1.4） - JavaDoc生成用</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Warnings+Plugin" rel="nofollow noopener" target="_blank">Warnings Plugin</a>（v4.60） - ジョブ実行時の警告メッセージを収集してくれる</li>
<li>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/JaCoCo+Plugin" rel="nofollow noopener" target="_blank">JaCoCo Plugin</a>（v2.2.0） - テストカバレッジのレポート生成用</li>
</ul>

<h1>
<span id="jenkinsfile" class="fragment"></span><a href="#jenkinsfile"><i class="fa fa-link"></i></a>Jenkinsfile</h1>

<p>GithubからWebhookでJenkinsのパイプラインジョブを実行する。<br>
パイプラインジョブではGithubのJenkinsfileを使う。<br>
ジョブの流れは下記。デプロイは静的コード解析とテストが成功したときだけ実行する。<br>
<a href="https://camo.qiitausercontent.com/a055f84cfb5b829f162a94d38542e6ab990a5199/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f35366338653132642d323637622d613633372d323234652d6663386362333437346466612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a055f84cfb5b829f162a94d38542e6ab990a5199/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f35366338653132642d323637622d613633372d323234652d6663386362333437346466612e706e67" alt="image" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/49915/56c8e12d-267b-a637-224e-fc8cb3474dfa.png"></a></p>

<div class="code-frame" data-lang="groovy">
<div class="code-lang"><span class="bold">Jenkinsfile</span></div>
<div class="highlight"><pre><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="c1">// 定数や変数を定義する</span>
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">reportDir</span> <span class="o">=</span> <span class="s1">'build/reports'</span>
        <span class="n">javaDir</span> <span class="o">=</span> <span class="s1">'src/main/java'</span>
        <span class="n">resourcesDir</span> <span class="o">=</span> <span class="s1">'src/main/resources'</span>
        <span class="n">testReportDir</span> <span class="o">=</span> <span class="s1">'build/test-results/test'</span>
        <span class="n">jacocoReportDir</span> <span class="o">=</span> <span class="s1">'build/jacoco'</span> 
        <span class="n">javadocDir</span> <span class="o">=</span> <span class="s1">'build/docs/javadoc'</span>
        <span class="n">libsDir</span> <span class="o">=</span> <span class="s1">'build/libs'</span>
        <span class="n">appName</span> <span class="o">=</span> <span class="s1">'SampleApp'</span>
        <span class="n">appVersion</span> <span class="o">=</span> <span class="s1">'1.0.0'</span>
    <span class="o">}</span>

    <span class="c1">// stagesブロック中に一つ以上のstageを定義する</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'事前準備'</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 実際の処理はstepsブロック中に定義する</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">deleteDir</span><span class="o">()</span>

                <span class="c1">// このJobをトリガーしてきたGithubのプロジェクトをチェックアウト</span>
                <span class="n">checkout</span> <span class="n">scm</span>

                <span class="c1">// ジョブ失敗の原因調査用にJenkinsfileとbuild.gradleは最初に保存する</span>
                <span class="n">archiveArtifacts</span> <span class="s2">"Jenkinsfile"</span>
                <span class="n">archiveArtifacts</span> <span class="s2">"build.gradle"</span>

                <span class="c1">// scriptブロックを使うと従来のScripted Pipelinesの記法も使える</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="c1">// Permission deniedで怒られないために実行権限を付与する</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">isUnix</span><span class="o">())</span> <span class="o">{</span>
                        <span class="n">sh</span> <span class="s1">'chmod +x gradlew'</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="n">gradlew</span> <span class="s1">'clean'</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'コンパイル'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">gradlew</span> <span class="s1">'classes testClasses'</span>
            <span class="o">}</span>

            <span class="c1">// postブロックでstepsブロックの後に実行される処理が定義できる</span>
            <span class="n">post</span> <span class="o">{</span>
                <span class="c1">// alwaysブロックはstepsブロックの処理が失敗しても成功しても必ず実行される</span>
                <span class="n">always</span> <span class="o">{</span>

                    <span class="c1">// JavaDoc生成時に実行するとJavaDocの警告も含まれてしまうので</span>
                    <span class="c1">// Javaコンパイル時の警告はコンパイル直後に収集する</span>
                    <span class="n">step</span><span class="o">([</span>

                        <span class="c1">// プラグインを実行するときのクラス指定は完全修飾名でなくてもOK</span>
                        <span class="n">$class</span><span class="o">:</span> <span class="s1">'WarningsPublisher'</span><span class="o">,</span>

                        <span class="c1">// Job実行時のコンソールから警告を収集する場合はconsoleParsers、</span>
                        <span class="c1">// pmd.xmlなどのファイルから収集する場合はparserConfigurationsを指定する。</span>
                        <span class="c1">// なおparserConfigurationsの場合はparserNameのほかにpattern(集計対象ファイルのパス)も指定が必要</span>
                        <span class="c1">// パーサ名は下記プロパティファイルに定義されているものを使う</span>
                        <span class="c1">// https://github.com/jenkinsci/warnings-plugin/blob/master/src/main/resources/hudson/plugins/warnings/parser/Messages.properties</span>
                        <span class="nl">consoleParsers:</span> <span class="o">[</span>
                            <span class="o">[</span><span class="nl">parserName:</span> <span class="s1">'Java Compiler (javac)'</span><span class="o">],</span>
                        <span class="o">],</span>
                        <span class="nl">canComputeNew:</span> <span class="kc">false</span><span class="o">,</span>
                        <span class="nl">canResolveRelativesPaths:</span> <span class="kc">false</span><span class="o">,</span>
                        <span class="nl">usePreviousBuildAsReference:</span> <span class="kc">true</span>
                    <span class="o">])</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'静的コード解析'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="c1">// 並列処理の場合はparallelメソッドを使う</span>
                <span class="n">parallel</span><span class="o">(</span>
                    <span class="s1">'静的コード解析'</span> <span class="o">:</span> <span class="o">{</span>
                        <span class="n">gradlew</span> <span class="s1">'check -x test'</span>

                        <span class="c1">// dirメソッドでカレントディレクトリを指定できる</span>
                        <span class="n">dir</span><span class="o">(</span><span class="n">reportDir</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">step</span><span class="o">([</span>
                                <span class="n">$class</span><span class="o">:</span> <span class="s1">'CheckStylePublisher'</span><span class="o">,</span>
                                <span class="nl">pattern:</span> <span class="s2">"checkstyle/*.xml"</span>
                            <span class="o">])</span>
                            <span class="n">step</span><span class="o">([</span>
                                <span class="n">$class</span><span class="o">:</span> <span class="s1">'FindBugsPublisher'</span><span class="o">,</span>
                                <span class="nl">pattern:</span> <span class="s2">"findbugs/*.xml"</span>
                            <span class="o">])</span>
                            <span class="n">step</span><span class="o">([</span>
                                <span class="n">$class</span><span class="o">:</span> <span class="s1">'PmdPublisher'</span><span class="o">,</span>
                                <span class="nl">pattern:</span> <span class="s2">"pmd/*.xml"</span>
                            <span class="o">])</span>
                            <span class="n">step</span><span class="o">([</span>
                                <span class="n">$class</span><span class="o">:</span> <span class="s1">'DryPublisher'</span><span class="o">,</span>
                                <span class="nl">pattern:</span> <span class="s2">"cpd/*.xml"</span>
                            <span class="o">])</span>

                            <span class="n">archiveArtifacts</span> <span class="s2">"checkstyle/*.xml"</span>
                            <span class="n">archiveArtifacts</span> <span class="s2">"findbugs/*.xml"</span>
                            <span class="n">archiveArtifacts</span> <span class="s2">"pmd/*.xml"</span>
                            <span class="n">archiveArtifacts</span> <span class="s2">"cpd/*.xml"</span>
                        <span class="o">}</span>
                    <span class="o">},</span>
                    <span class="s1">'ステップカウント'</span><span class="o">:</span> <span class="o">{</span>
                        <span class="c1">// レポート作成</span>
                        <span class="c1">// outputFileとoutputFormatを指定するとエクセルファイルも作成してくれる</span>
                        <span class="n">stepcounter</span> <span class="nl">outputFile:</span> <span class="s1">'stepcount.xls'</span><span class="o">,</span> <span class="nl">outputFormat:</span> <span class="s1">'excel'</span><span class="o">,</span> <span class="nl">settings:</span> <span class="o">[</span>
                            <span class="o">[</span><span class="nl">key:</span><span class="s1">'Java'</span><span class="o">,</span> <span class="nl">filePattern:</span> <span class="s2">"${javaDir}/**/*.java"</span><span class="o">],</span>
                            <span class="o">[</span><span class="nl">key:</span><span class="s1">'SQL'</span><span class="o">,</span> <span class="nl">filePattern:</span> <span class="s2">"${resourcesDir}/**/*.sql"</span><span class="o">],</span>
                            <span class="o">[</span><span class="nl">key:</span><span class="s1">'HTML'</span><span class="o">,</span> <span class="nl">filePattern:</span> <span class="s2">"${resourcesDir}/**/*.html"</span><span class="o">],</span>
                            <span class="o">[</span><span class="nl">key:</span><span class="s1">'JS'</span><span class="o">,</span> <span class="nl">filePattern:</span> <span class="s2">"${resourcesDir}/**/*.js"</span><span class="o">],</span>
                            <span class="o">[</span><span class="nl">key:</span><span class="s1">'CSS'</span><span class="o">,</span> <span class="nl">filePattern:</span> <span class="s2">"${resourcesDir}/**/*.css"</span><span class="o">]</span>
                        <span class="o">]</span>
                        <span class="c1">// 一応エクセルファイルも成果物として保存する</span>
                        <span class="n">archiveArtifacts</span> <span class="s2">"stepcount.xls"</span>
                    <span class="o">},</span>
                    <span class="s1">'タスクスキャン'</span><span class="o">:</span> <span class="o">{</span>
                        <span class="n">step</span><span class="o">([</span>
                            <span class="n">$class</span><span class="o">:</span> <span class="s1">'TasksPublisher'</span><span class="o">,</span>
                            <span class="nl">pattern:</span> <span class="s1">'./**'</span><span class="o">,</span>
                            <span class="c1">// 集計対象を検索するときに大文字小文字を区別するか</span>
                            <span class="nl">ignoreCase:</span> <span class="kc">true</span><span class="o">,</span>
                            <span class="c1">// 優先度別に集計対象の文字列を指定できる</span>
                            <span class="c1">// 複数指定する場合はカンマ区切りの文字列を指定する</span>
                            <span class="nl">high:</span> <span class="s1">'System.out.System.err'</span><span class="o">,</span>
                            <span class="nl">normal:</span> <span class="s1">'TODO,FIXME,XXX'</span><span class="o">,</span>
                        <span class="o">])</span>
                    <span class="o">},</span>
                    <span class="s1">'JavaDoc'</span><span class="o">:</span> <span class="o">{</span>
                        <span class="n">gradlew</span> <span class="s1">'javadoc -x classes'</span>
                        <span class="n">step</span><span class="o">([</span>
                            <span class="n">$class</span><span class="o">:</span> <span class="s1">'JavadocArchiver'</span><span class="o">,</span>
                            <span class="c1">// Javadocのindex.htmlがあるフォルダのパスを指定する</span>
                            <span class="nl">javadocDir:</span> <span class="s2">"${javadocDir}"</span><span class="o">,</span>
                            <span class="nl">keepAll:</span> <span class="kc">true</span>
                        <span class="o">])</span>
                    <span class="o">}</span>
                <span class="o">)</span>
            <span class="o">}</span>

            <span class="n">post</span> <span class="o">{</span>
                <span class="n">always</span> <span class="o">{</span>
                   <span class="c1">// JavaDocの警告を収集</span>
                    <span class="n">step</span><span class="o">([</span>
                        <span class="n">$class</span><span class="o">:</span> <span class="s1">'WarningsPublisher'</span><span class="o">,</span>
                        <span class="nl">consoleParsers:</span> <span class="o">[</span>
                            <span class="o">[</span><span class="nl">parserName:</span> <span class="s1">'JavaDoc Tool'</span><span class="o">]</span>
                        <span class="o">],</span>
                        <span class="nl">canComputeNew:</span> <span class="kc">false</span><span class="o">,</span>
                        <span class="nl">canResolveRelativesPaths:</span> <span class="kc">false</span><span class="o">,</span>
                        <span class="nl">usePreviousBuildAsReference:</span> <span class="kc">true</span>
                    <span class="o">])</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>


        <span class="n">stage</span><span class="o">(</span><span class="s1">'テスト'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">gradlew</span> <span class="s1">'test jacocoTestReport -x classes -x testClasses'</span>

                <span class="n">junit</span> <span class="s2">"${testReportDir}/*.xml"</span>
                <span class="n">archiveArtifacts</span> <span class="s2">"${testReportDir}/*.xml"</span>

                <span class="c1">// カバレッジレポートを生成（テストクラスを除外）</span>
                <span class="n">step</span><span class="o">([</span>
                    <span class="n">$class</span><span class="o">:</span> <span class="s1">'JacocoPublisher'</span><span class="o">,</span>
                    <span class="nl">execPattern:</span> <span class="s2">"${jacocoReportDir}/*.exec"</span><span class="o">,</span>
                    <span class="nl">exclusionPattern:</span> <span class="s1">'**/*Test.class'</span>
                <span class="o">])</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'デプロイ'</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// whenブロックでstageを実行する条件を指定できる</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="c1">// 静的コード解析とテスト失敗時はデプロイしない</span>
                <span class="n">expression</span> <span class="o">{</span><span class="n">currentBuild</span><span class="o">.</span><span class="na">currentResult</span> <span class="o">==</span> <span class="s1">'SUCCESS'</span><span class="o">}</span>
            <span class="o">}</span>

            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">gradlew</span> <span class="s1">'jar'</span>
                <span class="n">archiveArtifacts</span> <span class="s2">"${libsDir}/${appName}-${appVersion}.jar"</span>
                <span class="n">gradlew</span> <span class="s1">'war'</span>
                <span class="n">archiveArtifacts</span> <span class="s2">"${libsDir}/${appName}-${appVersion}.war"</span>
                <span class="n">deploy</span> <span class="nl">warDir:</span> <span class="n">libsDir</span><span class="o">,</span> <span class="nl">appName:</span> <span class="n">appName</span><span class="o">,</span> <span class="nl">appVersion:</span> <span class="n">appVersion</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// stagesブロックと同じレベルにpostブロックを定義すると</span>
    <span class="c1">// 全てのstage処理が終わった後の処理の定義が可能    </span>
    <span class="n">post</span> <span class="o">{</span>
        <span class="n">always</span> <span class="o">{</span>
            <span class="c1">// 最後にワークスペースの中身を削除</span>
            <span class="n">deleteDir</span><span class="o">()</span>
        <span class="o">}</span>
        <span class="c1">// 連続で成功しているとき以外は自分宛にメールを送信</span>

        <span class="c1">// 結果が前回と変わった時</span>
        <span class="n">changed</span> <span class="o">{</span>
            <span class="n">sendMail</span><span class="o">(</span><span class="s2">"${currentBuild.previousBuild.result} =&gt; ${currentBuild.currentResult}"</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="c1">// 失敗した時</span>
        <span class="n">failure</span> <span class="o">{</span>
            <span class="n">sendMail</span><span class="o">(</span><span class="n">currentBuild</span><span class="o">.</span><span class="na">currentResult</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="c1">// 不安定な時（主にテスト失敗時）</span>
        <span class="n">unstable</span> <span class="o">{</span>
            <span class="n">sendMail</span><span class="o">(</span><span class="n">currentBuild</span><span class="o">.</span><span class="na">currentResult</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="c1">// Gradlewコマンドを実行する</span>
<span class="kt">def</span> <span class="nf">gradlew</span><span class="o">(</span><span class="n">command</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">isUnix</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">sh</span> <span class="s2">"./gradlew ${command} --stacktrace"</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">bat</span> <span class="s2">"./gradlew.bat ${command} --stacktrace"</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// デプロイする</span>
<span class="c1">// args.warDir warの格納ディレクトリ </span>
<span class="c1">// args.appName アプリ名</span>
<span class="c1">// args.appVersion アプリのバージョン</span>
<span class="kt">def</span> <span class="nf">deploy</span><span class="o">(</span><span class="n">Map</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 秘密鍵のパス ※Tomcatサーバにファイル転送するので事前にJenkinsサーバのどこかに秘密鍵を格納しておく必要がある</span>
    <span class="kt">def</span> <span class="n">keyDir</span> <span class="o">=</span> <span class="s1">'/var/lib/jenkins/.ssh/xxx'</span>
    <span class="c1">// Tomcatサーバのアドレスとユーザ名</span>
    <span class="kt">def</span> <span class="n">webServerAddress</span> <span class="o">=</span> <span class="s1">'ecX-XX-XXX-X-X.xx-xxxx-x.xxxxxxxx'</span>
    <span class="kt">def</span> <span class="n">webServerUser</span> <span class="o">=</span> <span class="s1">'hoge-user'</span>
    <span class="kt">def</span> <span class="n">webServer</span> <span class="o">=</span> <span class="s2">"${webServerUser}@${webServerAddress}"</span>

    <span class="kt">def</span> <span class="n">srcWar</span> <span class="o">=</span> <span class="s2">"${args.appName}-${args.appVersion}.war"</span>
    <span class="kt">def</span> <span class="n">destWar</span> <span class="o">=</span> <span class="s2">"${args.appName}.war"</span>

    <span class="c1">// ファイル転送してTomcatのwebappsにwarを配置する</span>
    <span class="n">sh</span> <span class="s2">"sudo -S scp -i ${keyDir} ./${args.warDir}/${srcWar} ${webServer}:/home/ec2-user"</span>
    <span class="n">sh</span> <span class="s2">"sudo -S ssh -i ${keyDir} ${webServer} \"sudo cp /home/ec2-user/${srcWar} /usr/share/tomcat8/webapps/${destWar}\""</span>
<span class="o">}</span>

<span class="c1">// メールをGmailに送信する</span>
<span class="kt">def</span> <span class="nf">sendMail</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">mail</span> <span class="nl">to:</span> <span class="s2">"xxxxxxxx@gmail.com"</span><span class="o">,</span>
        <span class="nl">subject:</span> <span class="s2">"${env.JOB_NAME} #${env.BUILD_NUMBER} [${result}]"</span><span class="o">,</span>
        <span class="nl">body:</span> <span class="s2">"Build URL: ${env.BUILD_URL}.\n\n"</span>
<span class="o">}</span>
</pre></div>
</div>

<h1>
<span id="躓いたこと" class="fragment"></span><a href="#%E8%BA%93%E3%81%84%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>躓いたこと</h1>

<ul>
<li>各プラグインともChangelogに「パイプライン対応したよ！」とは書いてあるが、
具体的は書き方は明記していないことが多いので、
各プラグインのGithubでソースコード（主に「なんちゃらPublisher」クラス）を見ながら、Jenkinsfileを書いた。</li>
<li>currentBuildオブジェクトの使い方がよくわからなかったが、Jenkinsのパイプラインジョブ &gt; 設定 &gt; Pipeline Syntax &gt; Global Variables Reference に詳しく載っていた。
<a href="https://camo.qiitausercontent.com/dce98ca18e752127b3f57901a65249f540d2193f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f30663631366435302d633537662d323335652d633231342d3863386430643139646139372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/dce98ca18e752127b3f57901a65249f540d2193f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f30663631366435302d633537662d323335652d633231342d3863386430643139646139372e706e67" alt="image" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/49915/0f616d50-c57f-235e-c214-8c8d0d19da97.png"></a>
</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/f2249e2915cbfd8a261d64823199f32a147bfe7a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f61386666326463662d396438352d376334312d316565302d6662346638336562336333632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f2249e2915cbfd8a261d64823199f32a147bfe7a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f61386666326463662d396438352d376334312d316565302d6662346638336562336333632e706e67" alt="image" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/49915/a8ff2dcf-9d85-7c41-1ee0-fb4f83eb3c3c.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/313541fc7e1ffe9781ad27141ed0b9d59400be18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f66363362353066352d373639642d386666322d313930392d6630366165636330373130362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/313541fc7e1ffe9781ad27141ed0b9d59400be18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f66363362353066352d373639642d386666322d313930392d6630366165636330373130362e706e67" alt="image" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/49915/f63b50f5-769d-8ff2-1909-f06aecc07106.png"></a></p>

<ul>
<li>カバレッジレポートはbuild.gradleのjacocoTestReportタスクでカバレッジレポート対象外にしていてもJenkinsのほうではうまく除外されなかったので、Jenkinsfileのほうでも対象外設定をした。</li>
<li>JenkinsからGmailにメールする場合、Jenkins &gt; Jenkinsの管理 &gt; システムの設定 &gt; E-mail通知で下記のような設定が必要だった。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/a9ab429d39d5959f7d05fe968d1110ccd53738f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f38356139313162622d303931642d393936622d333663612d6366303336306336353539322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a9ab429d39d5959f7d05fe968d1110ccd53738f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f38356139313162622d303931642d393936622d333663612d6366303336306336353539322e706e67" alt="image" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/49915/85a911bb-091d-996b-36ca-cf0360c65592.png"></a></p>

<ul>
<li>JenkinsからGmailにメールする場合、<a href="https://support.google.com/accounts/answer/6010255?hl=ja" rel="nofollow noopener" target="_blank">安全性の低いアプリがアカウントにアクセスするのを許可する</a>の手順に従って許可を有効にする必要があった。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/2758c73a3bb32139599ba67b88c6ac3e77bae419/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f32343738646535352d633338332d396130622d366564622d3934623365383438376666342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2758c73a3bb32139599ba67b88c6ac3e77bae419/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f34393931352f32343738646535352d633338332d396130622d366564622d3934623365383438376666342e706e67" alt="image" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/49915/2478de55-c383-9a0b-6edb-94b3e8487ff4.png"></a></p>

<h1>
<span id="buildgradle" class="fragment"></span><a href="#buildgradle"><i class="fa fa-link"></i></a>build.gradle</h1>

<p>Jenkins自体は、Gradleのコマンドを実行して出力結果をもとにレポートを生成するだけなので、<br>
GradleのJavaアプリのbuild.gradleで下記処理が実行できるようになっている必要があります。<br>
またJenkinsでGradleをインストールしなくていいようにGradleラッパーを作成しておきます。</p>

<ul>
<li>checkstyle</li>
<li>findbugs</li>
<li>pmd</li>
<li>cpd(重複コードチェック)</li>
<li>test</li>
<li>jacocoReport</li>
<li>jar</li>
<li>war</li>
</ul>

<p>例えばこんな</p>

<div class="code-frame" data-lang="groovy">
<div class="code-lang"><span class="bold">build.gradle</span></div>
<div class="highlight"><pre><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'war'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'checkstyle'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'findbugs'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'pmd'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'jacoco'</span>

<span class="n">ext</span> <span class="o">{</span>
    <span class="n">appVersion</span> <span class="o">=</span> <span class="s1">'1.0.0'</span>
    <span class="n">appName</span> <span class="o">=</span> <span class="s1">'SampleApp'</span>
    <span class="n">javaVersion</span> <span class="o">=</span> <span class="mf">1.8</span>
    <span class="n">defaultEncoding</span> <span class="o">=</span> <span class="s1">'UTF-8'</span>
<span class="o">}</span>

<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="n">javaVersion</span>
<span class="n">targetCompatibility</span>  <span class="o">=</span> <span class="n">javaVersion</span>
<span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">AbstractCompile</span><span class="o">)*.</span><span class="na">options</span><span class="o">*.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">defaultEncoding</span>
<span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">GroovyCompile</span><span class="o">)*.</span><span class="na">groovyOptions</span><span class="o">*.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">defaultEncoding</span>
<span class="n">mainClassName</span> <span class="o">=</span> <span class="s1">'jp.takumon.sapmleapp.App'</span>

<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// 依存ライブラリを記載 </span>

    <span class="n">compile</span> <span class="nl">group:</span> <span class="s1">'junit'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'junit'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'4.12'</span>
<span class="o">}</span>

<span class="n">jar</span> <span class="o">{</span>
    <span class="n">baseName</span> <span class="o">=</span> <span class="n">appName</span>
    <span class="n">version</span> <span class="o">=</span>  <span class="n">appVersion</span>
<span class="o">}</span>

<span class="n">war</span> <span class="o">{</span>
    <span class="n">baseName</span> <span class="o">=</span> <span class="n">appName</span>
    <span class="n">version</span> <span class="o">=</span>  <span class="n">appVersion</span>
<span class="o">}</span>

<span class="n">checkstyle</span> <span class="o">{</span>
    <span class="c1">// 失敗しても後続の処理を継続させる</span>
    <span class="n">ignoreFailures</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">sourceSets</span> <span class="o">=</span> <span class="o">[</span><span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">]</span>
    <span class="n">toolVersion</span> <span class="o">=</span> <span class="s1">'7.6.1'</span>
<span class="o">}</span>

<span class="n">findbugs</span> <span class="o">{</span>
    <span class="c1">// 失敗しても後続の処理を継続させる</span>
    <span class="n">ignoreFailures</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">sourceSets</span> <span class="o">=</span> <span class="o">[</span><span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">]</span>
    <span class="n">toolVersion</span> <span class="o">=</span> <span class="s2">"3.0.1"</span>
<span class="o">}</span>

<span class="n">pmd</span> <span class="o">{</span>
    <span class="c1">// 失敗しても後続の処理を継続させる</span>
    <span class="n">ignoreFailures</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">sourceSets</span> <span class="o">=</span> <span class="o">[</span><span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">]</span>
<span class="o">}</span>

<span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">Pmd</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">reports</span> <span class="o">{</span>
      <span class="n">xml</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// CPD（重複コードチェック処理）をCheckタスクに追加</span>
<span class="n">check</span><span class="o">.</span><span class="na">doLast</span> <span class="o">{</span>
    <span class="n">File</span> <span class="n">outputDir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s2">"$reportsDir/cpd/"</span><span class="o">)</span>
    <span class="n">outputDir</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">()</span>

    <span class="n">ant</span><span class="o">.</span><span class="na">taskdef</span><span class="o">(</span>
        <span class="nl">name:</span> <span class="s1">'cpd'</span><span class="o">,</span> 
        <span class="nl">classname:</span> <span class="s1">'net.sourceforge.pmd.cpd.CPDTask'</span><span class="o">,</span>
        <span class="nl">classpath:</span> <span class="n">configurations</span><span class="o">.</span><span class="na">pmd</span><span class="o">.</span><span class="na">asPath</span><span class="o">)</span>

    <span class="n">ant</span><span class="o">.</span><span class="na">cpd</span><span class="o">(</span>
        <span class="nl">minimumTokenCount:</span> <span class="s1">'100'</span><span class="o">,</span>
        <span class="nl">format:</span> <span class="s1">'xml'</span><span class="o">,</span>
        <span class="nl">encoding:</span> <span class="n">defaultEncoding</span><span class="o">,</span>
        <span class="nl">outputFile:</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">outputDir</span><span class="o">,</span> <span class="s1">'cpd.xml'</span><span class="o">)</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span> <span class="s2">"src/main/java"</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">include</span><span class="o">(</span><span class="nl">name:</span> <span class="s1">'**/*.java'</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">javadoc</span> <span class="o">{</span>
    <span class="n">failOnError</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="c1">// 好みのレベルで</span>
    <span class="n">options</span><span class="o">.</span><span class="na">memberLevel</span> <span class="o">=</span> <span class="n">JavadocMemberLevel</span><span class="o">.</span><span class="na">PRIVATE</span>
<span class="o">}</span>

<span class="n">test</span> <span class="o">{</span>
    <span class="c1">// 失敗しても後続の処理を継続させる</span>
    <span class="n">ignoreFailures</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">reports</span> <span class="o">{</span>
        <span class="n">junitXml</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">jacoco</span> <span class="o">{</span>
    <span class="n">toolVersion</span> <span class="o">=</span> <span class="s1">'0.7.5.201505241946'</span>
<span class="o">}</span>

<span class="n">jacocoTestReport</span> <span class="o">{</span>
    <span class="n">reports</span> <span class="o">{</span>
      <span class="n">xml</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">}</span>

    <span class="c1">// カバレッジレポートからテストクラスを除外</span>
    <span class="n">afterEvaluate</span> <span class="o">{</span> 
        <span class="n">classDirectories</span> <span class="o">=</span> <span class="n">files</span><span class="o">(</span><span class="n">classDirectories</span><span class="o">.</span><span class="na">files</span><span class="o">.</span><span class="na">collect</span> <span class="o">{</span>
            <span class="n">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="n">it</span><span class="o">,</span> <span class="nl">exclude:</span> <span class="o">[</span><span class="s1">'**/*Test.class'</span><span class="o">])</span> 
        <span class="o">})</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">wrapper</span> <span class="o">(</span><span class="nl">type:</span> <span class="n">Wrapper</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">gradleVersion</span> <span class="o">=</span> <span class="s1">'3.4.1'</span>
<span class="o">}</span>
</pre></div>
</div>

<p>以上。</p>
</div><hr style="margin-bottom:1.75rem"/><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/gatsby-starter-qiita/e6e81f10-e1df-58fa-ad49-6da5d018abc4/">← <!-- -->Java SE8 Gold取りました。</a></li><li><a rel="next" href="/gatsby-starter-qiita/386efa75-7773-5424-94a8-1a2b3ae52a6b/">Asciidoc文法クイックリファレンスの日本語訳<!-- --> →</a></li></ul></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-qiita-post-js","jsonName":"4-bf-6-ffd-5-8640-508-e-ab-47-1-a-55-df-05-d-72-e-20d","path":"/4bf6ffd5-8640-508e-ab47-1a55df05d72e/"};window.dataPath="326/path---4-bf-6-ffd-5-8640-508-e-ab-47-1-a-55-df-05-d-72-e-20-d-e6b-xJbqEgGNSIsx1sPNn7ZW7tNNs";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-1b1aadb11d2b90792575.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-9c88d686516c3299937a.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.5b3dc63a45b213e05e7a.css","/component---src-templates-blog-post-js-7ecbb398daf1854b90b2.js"],"component---src-templates-qiita-post-js":["/component---src-templates-qiita-post-js.5b3dc63a45b213e05e7a.css","/component---src-templates-qiita-post-js-2ffd488fa72a847d9af2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f28b7050d51a8c475c94.js"],"component---src-pages-index-js":["/component---src-pages-index-js.5b3dc63a45b213e05e7a.css","/component---src-pages-index-js-ad8f3d0b95dd4b85d744.js"]};/*]]>*/</script><script src="/gatsby-starter-qiita/webpack-runtime-2dc60d7c33a667247058.js" async=""></script><script src="/gatsby-starter-qiita/app-1b1aadb11d2b90792575.js" async=""></script><script src="/gatsby-starter-qiita/0-187f6b47a30213241321.js" async=""></script><script src="/gatsby-starter-qiita/component---src-templates-qiita-post-js-2ffd488fa72a847d9af2.js" async=""></script></body></html>